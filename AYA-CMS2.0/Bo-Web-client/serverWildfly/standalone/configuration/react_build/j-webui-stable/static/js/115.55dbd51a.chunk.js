(this["webpackJsonpstable-app"]=this["webpackJsonpstable-app"]||[]).push([[115],{179:function(t,e,i){"use strict";i.r(e);var s=i(0),o=i.n(s),l=i(1),a=i(5),n=i(4);let r=Object(n.b)("jwebui_roleMatrix"),d=Object(n.b)("jwebui_role_matrix_manager");class c extends s.Component{constructor(t){var e;super(t),this.changeKeyLanguage=t=>{let e={note:l.g.getLang("note"),title_:l.g.getLang("roleMatrix_title"),des_:l.g.getLang("roleMatrix_des"),function:l.g.getLang("roleMatrix_function"),role:l.g.getLang("roleMatrix_role"),power:l.g.getLang("roleMatrix_power"),rolesearch:l.g.getLang("roleMatrix_rolesearch"),permissionsearch:l.g.getLang("roleMatrix_permissionsearch"),access_function:l.g.getLang("roleMatrix_accessFunction"),data_monitoring:l.g.getLang("roleMatrix_dataMonitoring"),decentralized_objects:l.g.getLang("roleMatrix_decentralizedObjects"),constructor:l.g.getLang("roleMatrix_constructor"),set_up_power:l.g.getLang("roleMatrix_setUpPower")};if(void 0!==t)return e;let i=this.stateHidden.infoA;i.title=l.g.getLang("roleMatrix_title"),i.des=l.g.getLang("roleMatrix_des"),i.lang_form.vi=l.g.getLang("roleMatrix_title"),i.lang_form.en=l.g.getLang("roleMatrix_title"),this.stateHidden.infoA=i,this.stateHidden.languages=e,this.setState({lang_key:l.g.getLangKey()}),this.changeLanguageTemplate(e)},this.getInfoA=()=>this.stateHidden.infoA,this.getKeyFormAuto=()=>this.key_form,this.callSetHidden=t=>{this.stateHidden.hidden="none"===t,this.setState({reload:!0})},this.abs_search_role=t=>{let e=this.state.stateData;e.role_search.value=t.target.value,e.listButton=this.ROLE_SYSTEM.filter(e=>{let i=e.role_system.role_system_name.toLowerCase(),s=t.target.value.toLowerCase();return i.includes(s)}).map((t,e)=>({dataFull:{config:{default:{title:t.role_system.role_system_name,type:0===e?"primary":"",class:"col-sm-12"}},dataItem:{id:t.role_system.role_system_id}},abs_Click:this.abs_select_role})),this.setState({stateData:e})},this.abs_search_form=t=>{let e=t.target.value,i=this.state.stateData,s=this.MENU_TEMPLATE.filter(t=>t.title.toLowerCase().includes(e.toLowerCase()));this.list_menu_id=s.map(t=>t.id),s=this.getListMenuChild(s),s=this.getListMenuParent(s),i.form_search.value=e,i.listTreeItem.tree_data=s,this.setState({stateData:i,form_search:""})},this.abs_select_item_menu=(t,e)=>{const i=e.dataItem.menu.group_menu.group_menu_function_code,s=this.state.role_select;this.onCallForm(i,s)},this.abs_select_role=(t,e)=>{let i=this.state.stateData;for(let s of i.listButton)s.dataFull.dataItem.id===e.id?s.dataFull.config.default.type="primary":s.dataFull.config.default.type="";this.setState({stateData:i,role_select:e.id},()=>{const t=this.state.form_select,e=this.state.role_select;this.onCallForm(t,e)})},this.buildActionStatus=t=>{let e=[],i=this.stateHidden.form_config.list_layout;for(const l in i){let a=i[l];for(const i in a.list_view){let l=a.list_view[i];for(const i in l.list_input){let a=l.list_input[i];if("cButton"===a.inputtype){var s,o;let i=a.default.name;e.push({name:i,status:!!(null===(s=t[this.state.role_select][a.default.codeHidden])||void 0===s||null===(o=s.component)||void 0===o?void 0:o.install)})}}}}return e},this.abs_Click_check_access_function=t=>{let e=this.stateHidden.form_role;e[this.state.role_select][this.state.form_select].form.accept=!e[this.state.role_select][this.state.form_select].form.accept;let i=this.stateHidden.form_config.list_layout;for(const s in i){let t=i[s];void 0===e[this.state.role_select][t.codeHidden]&&(e[this.state.role_select][t.codeHidden]={layout:{install:!0}});for(const i in t.list_view){let s=t.list_view[i];void 0===e[this.state.role_select][s.codeHidden]&&(e[this.state.role_select][s.codeHidden]={view:{install:!0}});for(const t in s.list_input){let i=s.list_input[t];void 0===e[this.state.role_select][i.default.codeHidden]&&(e[this.state.role_select][i.default.codeHidden]={component:{install:!0}})}}}a.b([{txcode:"#sys:bo-save-roleMatrix",input:{form_id:this.state.form_select,content:JSON.stringify(e),role_select:this.state.role_select,action_status:this.buildActionStatus(e)}}],{}).then(t=>{this.onCallForm(this.state.form_select,this.state.role_select)})},this.abs_Click_check_role_contructor=t=>{let e=this.stateHidden.form_role;e[this.state.role_select][t.codeHidden]={[t.type]:{install:!t.constructor}};let i=this.stateHidden.form_config.list_layout;switch(t.type){case"layout":for(const s in i){let o=i[s];if(o.codeHidden===t.codeHidden){for(const i in o.list_view){let s=o.list_view[i];e[this.state.role_select][s.codeHidden]={view:{install:!t.constructor}};for(const i in s.list_input){let o=s.list_input[i];e[this.state.role_select][o.default.codeHidden]={component:{install:!t.constructor}}}}break}}break;case"view":for(const s in i){let o=i[s];for(const i in o.list_view){let s=o.list_view[i];if(s.codeHidden===t.codeHidden){e[this.state.role_select][s.codeHidden]={view:{install:!t.constructor}};for(const i in s.list_input){let o=s.list_input[i];e[this.state.role_select][o.default.codeHidden]={component:{install:!t.constructor}}}break}}}}a.b([{txcode:"#sys:bo-save-roleMatrix",input:{form_id:this.state.form_select,content:JSON.stringify(e),role_select:this.state.role_select,action_status:this.buildActionStatus(e)}}],{}).then(t=>{this.onCallForm(this.state.form_select,this.state.role_select)})},this.getMenuTreeTemplate=()=>this.DATA_MENU.map(t=>({title:t.group_menu.group_menu_name||"#ERROR",parent_id:t.group_menu.group_menu_parent,is_open:!1,DOM_elm:null,id:t.group_menu.group_menu_id,dataItem:{menu:t},abs_click:this.abs_select_item_menu})),this.getCheckboxTreeTemplate=(t,e)=>{var i,s,o,l;return{abs_Click_check_access_function:this.abs_Click_check_access_function,access_function:(null===e||void 0===e||null===(i=e[t.info.form_code])||void 0===i||null===(s=i.form)||void 0===s?void 0:s.accept)||!1,data_monitoring:(null===e||void 0===e||null===(o=e[t.info.form_code])||void 0===o||null===(l=o.form)||void 0===l?void 0:l.follow)||!1,list_layout:t.list_layout.map(t=>{var i,s;return{dataItem:{type:"layout",codeHidden:t.codeHidden,constructor:(null===e||void 0===e||null===(i=e[t.codeHidden])||void 0===i?void 0:i.layout.install)||!1,permission:!1},name:t.name||"Layout: #NO_NAME",abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===e||void 0===e||null===(s=e[t.codeHidden])||void 0===s?void 0:s.layout.install)||!1,permission:!1,default:t.default,list_view:t.list_view.map(t=>{var i,s;return{dataItem:{type:"view",codeHidden:t.codeHidden,constructor:(null===e||void 0===e||null===(i=e[t.codeHidden])||void 0===i?void 0:i.view.install)||!1,permission:!1},name:t.name||"View: #NO_NAME",abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===e||void 0===e||null===(s=e[t.codeHidden])||void 0===s?void 0:s.view.install)||!1,permission:!1,default:t.default,list_input:t.list_input.map(t=>{var i,s;return{dataItem:{type:"component",codeHidden:t.default.codeHidden,constructor:(null===e||void 0===e||null===(i=e[t.default.codeHidden])||void 0===i?void 0:i.component.install)||!1,permission:!1},abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===e||void 0===e||null===(s=e[t.default.codeHidden])||void 0===s?void 0:s.component.install)||!1,permission:!1,default:t.default}})}})}})}},this.key_form="roleMatrix",this.DATA_MENU=l.g.getData("group_menu").sort((function(t,e){return t.group_menu.group_menu_order-e.group_menu.group_menu_order})),this.MENU_TEMPLATE=this.getMenuTreeTemplate(),this.ROLE_SYSTEM=l.g.getData("role_system");let i=this.changeKeyLanguage("start");this.stateHidden={infoA:{lang_form:{vi:l.g.getLang("roleMatrix_title"),en:l.g.getLang("roleMatrix_title")},title:"Permissions System",des:"H\u1ec7 th\u1ed1ng ph\xe2n quy\u1ec1n to\xe0n \u1ee9ng d\u1ee5ng!",openOne:"true",ofModal:!1},languages:i,role_task_tree:{},form_config:{},form_role:{},hidden:!1,role_filter:this.ROLE_SYSTEM,menu_filter:this.DATA_MENU},this.state={lang_key:l.g.getLangKey(),form_select:"",role_select:null===(e=this.ROLE_SYSTEM[0])||void 0===e?void 0:e.role_system.role_system_id,role_search:"",form_search:"",stateData:{form:{dataFull:{config:{default:{title:i.title_,title_sub:i.des_}},cmd:{visibility:""}}},role:{title:i.role},role_search:{placeholder:i.rolesearch,value:"",abs_search:this.abs_search_role},permission:{title:i.power},form_search:{placeholder:i.permissionsearch,value:"",abs_search:this.abs_search_form},listButton:this.ROLE_SYSTEM.map((t,e)=>({dataFull:{config:{default:{title:t.role_system.role_system_name,type:0===e?"primary":"",class:"col-sm-12"}},dataItem:{id:t.role_system.role_system_id}},abs_Click:this.abs_select_role})),listTreeItem:{tree_data:this.MENU_TEMPLATE,config:{open_one:!0,is_has_dom:!0}}}}}changeLanguageTemplate(t){let{stateData:e}=this.state;e.form.dataFull.config.default.title=t.title_,e.form.dataFull.config.default.title_sub=t.des_,e.role.title=t.role,e.role_search.placeholder=t.rolesearch,e.permission.title=t.power,e.form_search.placeholder=t.permissionsearch,this.setState({stateData:e})}componentWillMount(){this.state.stateData.listTreeItem.tree_data[0].DOM_elm=o.a.createElement(d,{dataFull:{access_function:!1,data_monitoring:!1,list_layout:[]},key:"no"})}componentDidMount(){l.g.addAppAuto(this.key_form,this,this.stateHidden.infoA.ofModal),l.g.form_addMapping(this.key_form,this.props.mapping_key)}getListMenuParent(t){for(const e of t){let i=this.getMenuTreeTemplate().filter(t=>t.id===e.parent_id&&!1===this.list_menu_id.includes(t.id)&&(this.list_menu_id.push(t.id),!0));(null===i||void 0===i?void 0:i.length)&&(t=t.concat(this.getListMenuParent(i)))}return t}getListMenuChild(t){for(const e of t){let i=this.getMenuTreeTemplate().filter(t=>t.parent_id===e.id&&!1===this.list_menu_id.includes(t.id)&&(this.list_menu_id.push(t.id),!0));(null===i||void 0===i?void 0:i.length)&&(t=t.concat(this.getListMenuChild(i)))}return t}convertRoleTaskTree(t){let e=this.state.role_select,i=this.state.form_select,s={[e]:{[i]:{form:{accept:!1,follow:!1}}}};return t.list_layout.forEach(t=>{s[e][t.codeHidden]={layout:{install:!0}},t.list_view.forEach(t=>{s[e][t.codeHidden]={view:{install:!0}},t.list_input.forEach(t=>{s[e][t.default.codeHidden]={component:{install:!0}}})})}),s}onCallForm(t,e){t&&e&&Object(a.b)([{txcode:"#sys:bo-load-formRole",input:{form_id:t}},{txcode:"#sys:bo-load-formId",input:{form_id:t}}],{}).then(i=>{var s=l.g.foGetData("form_design_detail",i);void 0===s&&(s={info:{form_code:t},list_layout:[]});var a=l.g.foGetData("loadRoleTask",i)||{};void 0===a[e]&&(a[e]={[t]:{form:{accept:!1,follow:!1}}});let n=this.state.stateData,r=n.listTreeItem.tree_data;for(let l of r)if(l.dataItem.menu.group_menu.group_menu_function_code===t){let i=this.getCheckboxTreeTemplate(s,a[e]);this.stateHidden.role_task_tree=i,l.DOM_elm=o.a.createElement(d,{dataFull:i,key:t})}n.listTreeItem.tree_data=r,this.stateHidden.form_config=s,this.stateHidden.form_role=a,this.setState({form_select:t,stateData:n})},t=>{})}render(){return o.a.createElement("div",{style:{display:this.stateHidden.hidden?"none":""}},o.a.createElement(r,{stateData:this.state.stateData}))}}e.default=c}}]);